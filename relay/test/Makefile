GCC = gcc
DEBUG_FLAG = -ggdb 
WALL= -Wall
LEAK_FLAG = --leak-check=full
LOG_FLAG = --log-file
THREAD_FLAG = -lpthread

VALGRIND = valgrind
TEST_INPUT = ../file_list/kivanc.txt

DEST_IP = 192.168.2.195 
DEST_PORT = 5050

TEST_SRC = test.c
TEST_QUEUE_DEP = ../queue.c ../reorder.c ../link_receptor.c 
QUEUE_FLAG = -que
TEST_QUEUE_TARGET = test_queue
TEST_QUEUE_LOG = queue.log

TEST_QUEUE_RUN = $(TEST_QUEUE_TARGET) $(QUEUE_FLAG) $(DEST_IP) $(DEST_PORT)

TEST_REORDER_DEP = ../queue.c ../reorder.c ../link_receptor.c 
TEST_REORDER_TARGET = test_reorder
REORDER_FLAG = -reord
TEST_REORDER_LOG = reorder.log

TEST_REORDER_RUN = $(TEST_REORDER_TARGET) $(REORDER_FLAG) $(DEST_IP) $(DEST_PORT)

$(TEST_QUEUE_TARGET): $(TEST_SRC) $(TEST_QUEUE_DEP)
	$(GCC) $(TEST_SRC) $(TEST_QUEUE_DEP) -o $(TEST_QUEUE_TARGET) $(DEBUG_FLAG) $(THREAD_FLAG) $(WALL) -lm
	$(VALGRIND) $(LOG_FLAG)=$(TEST_QUEUE_LOG) $(LEAK_FLAG) ./$(TEST_QUEUE_RUN) 
$(TEST_REORDER_TARGET): $(TEST_SRC) $(TEST_REORDER_DEP)
	$(GCC) $(TEST_SRC) $(TEST_REORDER_DEP) -o $(TEST_REORDER_TARGET) $(DEBUG_FLAG) $(THREAD_FLAG) $(WALL) -lm 
	$(VALGRIND) $(LOG_FLAG)=$(TEST_REORDER_LOG) $(LEAK_FLAG) ./$(TEST_REORDER_RUN)
clean:
	rm -rf $(TEST_QUEUE_TARGET) $(TEST_QUEUE_LOG) output.txt
